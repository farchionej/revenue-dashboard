<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jay Street Media Revenue</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            min-height: 100vh;
            padding: 20px;
            color: #1a1a1a;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);
        }
        
        h1 {
            color: #000000;
            margin-bottom: 40px;
            font-size: 2.25em;
            font-weight: 600;
            letter-spacing: -0.02em;
        }
        
        .sync-status {
            position: absolute;
            top: 30px;
            right: 30px;
            padding: 8px 16px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sync-status.syncing {
            background: #fff8e1;
            color: #f57c00;
        }
        
        .sync-status.error {
            background: #ffebee;
            color: #c62828;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .metric-card {
            background: #ffffff;
            border: 1px solid #e5e5e7;
            border-radius: 12px;
            padding: 24px;
            color: #1a1a1a;
            transition: all 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .metric-label {
            font-size: 0.875em;
            color: #86868b;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .metric-value {
            font-size: 2.25em;
            font-weight: 600;
            color: #000000;
            letter-spacing: -0.02em;
        }
        
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 40px;
            border-bottom: 1px solid #e5e5e7;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #86868b;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .tab:hover {
            background: #000000;
            color: #ffffff;
            border-radius: 8px 8px 0 0;
        }
        
        .tab.active {
            color: #000000;
        }
        
        .tab.active:hover {
            color: #ffffff;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
        }
        
        .tab.active:hover::after {
            display: none;
        }
        
        select, input, textarea {
            padding: 8px 12px;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.2s ease;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #000000;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.1);
        }
        
        button {
            padding: 10px 20px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background: #1a1a1a;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #f5f5f7;
            color: #000000;
        }
        
        .btn-secondary:hover {
            background: #e8e8ed;
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 12px;
            border: 1px solid #e5e5e7;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #fafafa;
            font-weight: 500;
            color: #000000;
            font-size: 0.875em;
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e5e7;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        tr:hover {
            background: #fafafa;
        }
        
        .status-paid {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
            cursor: pointer;
            display: inline-block;
            transition: all 0.2s ease;
        }
        
        .status-paid:hover {
            transform: scale(1.05) rotate(-2deg);
            box-shadow: 0 4px 8px rgba(46, 125, 50, 0.2);
            filter: brightness(1.1);
        }
        
        .status-paid:active {
            transform: scale(0.98);
        }
        
        .status-unpaid {
            background: #ffebee;
            color: #c62828;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
            cursor: pointer;
            display: inline-block;
            transition: all 0.2s ease;
        }
        
        .status-unpaid:hover {
            transform: scale(1.05) rotate(2deg);
            box-shadow: 0 4px 8px rgba(198, 40, 40, 0.2);
            filter: brightness(1.1);
        }
        
        .status-unpaid:active {
            transform: scale(0.98);
        }
        
        .status-paused {
            background: #f5f5f7;
            color: #86868b;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
            display: inline-block;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e5e7;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .chart-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #000000;
        }
        
        .status-active {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .status-hidden {
            background: #fce4ec;
            color: #c2185b;
        }
        
        .filter-button {
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #f5f5f7;
            color: #86868b;
            border: 1px solid #e5e5e7;
        }
        
        .filter-button:hover {
            background: #000000;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .filter-button.active {
            background: #000000;
            color: #ffffff;
        }
        
        .payment-history-grid {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        .payment-history-grid table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .payment-history-grid th {
            position: sticky;
            left: 0;
            background: #fafafa;
            z-index: 1;
        }
        
        .payment-history-grid .client-name {
            position: sticky;
            left: 0;
            background: white;
            font-weight: 500;
            min-width: 150px;
            z-index: 1;
        }
        
        .payment-history-grid .month-cell {
            text-align: center;
            padding: 8px;
            min-width: 60px;
            font-size: 0.85em;
        }
        
        .payment-history-grid .paid {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .payment-history-grid .unpaid {
            background: #ffebee;
            color: #c62828;
        }
        
        .payment-history-grid .paused {
            background: #fff8e1;
            color: #f57c00;
        }
        
        .payment-history-grid .inactive {
            background: #f5f5f7;
            color: #aaa;
        }
        
        .payment-history-grid .multiple-unpaid {
            border: 2px solid #c62828;
        }
        
        .payment-history-grid .unpaid-count {
            font-size: 0.75em;
            color: #666;
            margin-left: 5px;
        }
        
        .cash-flow-section {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid #e5e5e7;
        }
        
        .cash-flow-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 30px;
            color: #000000;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="sync-status" id="syncStatus">
            <span class="status-dot">●</span>
            <span>Ready</span>
        </div>
        
        <h1>Jay Street Media Revenue</h1>
        
        <div class="metrics-grid" id="metricsGrid">
            <div class="metric-card">
                <div class="metric-label">Monthly Revenue</div>
                <div class="metric-value" id="monthlyRevenue">$0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">YTD Revenue</div>
                <div class="metric-value" id="ytdRevenue">$0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Total Clients</div>
                <div class="metric-value" id="totalClients">0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Collection Rate</div>
                <div class="metric-value" id="collectionRate">0%</div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('payments')">Payment Tracking</button>
            <button class="tab" onclick="showTab('clients')">Manage Clients</button>
            <button class="tab" onclick="showTab('costs')">Cost Management</button>
            <button class="tab" onclick="showTab('analytics')">Analytics & Charts</button>
        </div>
        
        <!-- Payment Tracking Tab -->
        <div id="payments" class="tab-content active">
            <div class="controls">
                <label>Month: 
                    <input type="month" id="monthSelector" value="2025-08">
                </label>
                <button onclick="markAllPaid()">Mark All Paid</button>
                <button onclick="showUnpaid()">Show Unpaid</button>
                <button onclick="refreshPayments()" style="background: #2e7d32; color: white;">↻ Refresh</button>
            </div>
            
            <div class="controls">
                <span>Quick Filters:</span>
                <button class="filter-button active" onclick="filterByStatus('all', this)">All</button>
                <button class="filter-button" onclick="filterByStatus('paid', this)">Paid Only</button>
                <button class="filter-button" onclick="filterByStatus('unpaid', this)">Unpaid Only</button>
                <button class="filter-button" onclick="filterByStatus('paused', this)">Paused Only</button>
            </div>
            
            <div class="table-container">
                <table id="paymentsTable">
                    <thead>
                        <tr>
                            <th>Client Name</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Payment Date</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6" class="loading">Loading payments...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 40px;">
                <h3>YTD Payment History</h3>
                <p style="color: #86868b; font-size: 0.85em; margin: 10px 0;">
                    If you notice missing payment records, click "Sync Database" to create them automatically.
                </p>
                <div class="controls">
                    <select id="historyFilter" onchange="updatePaymentHistory()">
                        <option value="all">All Clients</option>
                        <option value="unpaid-current">Unpaid This Month</option>
                        <option value="has-unpaid">Has Any Unpaid</option>
                        <option value="multiple-unpaid">Multiple Unpaid (2+)</option>
                    </select>
                    <button onclick="exportPaymentGrid()">Export Grid</button>
                    <button onclick="syncPaymentDatabase()" style="background: #2e7d32; color: white;">
                        🔄 Sync Database
                    </button>
                </div>
                <div id="paymentHistoryGrid" class="payment-history-grid">
                    <!-- Grid will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Manage Clients Tab -->
        <div id="clients" class="tab-content">
            <div class="controls">
                <button onclick="showAddClientForm()">+ Add Client</button>
                <button onclick="exportClients()">Export Clients</button>
                <button onclick="refreshClients()">↻ Refresh</button>
            </div>
            
            <div id="addClientForm" style="display: none; margin-bottom: 20px; padding: 20px; background: #f5f5f7; border-radius: 8px;">
                <h3>Add New Client</h3>
                <div style="display: grid; gap: 10px; margin-top: 10px;">
                    <input type="text" id="newClientName" placeholder="Client Name">
                    <input type="number" id="newClientAmount" placeholder="Monthly Amount">
                    <input type="date" id="newClientStartDate" placeholder="Start Date">
                    <select id="newClientStatus">
                        <option value="active">Active</option>
                        <option value="paused">Paused</option>
                        <option value="hidden">Hidden</option>
                    </select>
                    <textarea id="newClientNotes" placeholder="Notes (optional)" rows="3"></textarea>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="addClient()">Save Client</button>
                        <button class="btn-secondary" onclick="hideAddClientForm()">Cancel</button>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table id="clientsTable">
                    <thead>
                        <tr>
                            <th>Client Name</th>
                            <th>Monthly Amount</th>
                            <th>Start Date</th>
                            <th>Status</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6" class="loading">Loading clients...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Cost Management Tab -->
        <div id="costs" class="tab-content">
            <div class="controls">
                <button onclick="showAddCostForm()">+ Add Cost</button>
                <button onclick="exportCosts()">Export Costs</button>
                <button onclick="refreshCosts()">↻ Refresh</button>
            </div>
            
            <div id="addCostForm" style="display: none; margin-bottom: 20px; padding: 20px; background: #f5f5f7; border-radius: 8px;">
                <h3>Add New Cost</h3>
                <div style="display: grid; gap: 10px; margin-top: 10px;">
                    <input type="text" id="newCostDescription" placeholder="Description">
                    <input type="number" id="newCostAmount" placeholder="Amount">
                    <select id="newCostType">
                        <option value="fixed">Fixed Monthly</option>
                        <option value="variable">Variable</option>
                        <option value="one-time">One-time</option>
                    </select>
                    <input type="date" id="newCostDate">
                    <textarea id="newCostNotes" placeholder="Notes (optional)" rows="3"></textarea>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="addCost()">Save Cost</button>
                        <button class="btn-secondary" onclick="hideAddCostForm()">Cancel</button>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table id="costsTable">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6" class="loading">Loading costs...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Analytics & Charts Tab -->
        <div id="analytics" class="tab-content">
            <div class="controls">
                <button onclick="loadAnalytics()">↻ Refresh Analytics</button>
                <button onclick="exportAnalytics()">Export to CSV</button>
                <select id="chartTimeRange" onchange="updateCharts()">
                    <option value="all">All Time</option>
                    <option value="2025">2025 Only</option>
                    <option value="2024">2024 Only</option>
                    <option value="last12">Last 12 Months</option>
                    <option value="last6">Last 6 Months</option>
                </select>
            </div>
            
            <h3 style="margin: 30px 0 20px 0;">Expected Revenue Analysis</h3>
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Expected Revenue Trend</div>
                    <div class="chart-wrapper">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Expected vs Goal</div>
                    <div class="chart-wrapper">
                        <canvas id="goalChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Expected Margin Trend</div>
                    <div class="chart-wrapper">
                        <canvas id="marginChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Expected Revenue vs Costs</div>
                    <div class="chart-wrapper">
                        <canvas id="costChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="cash-flow-section">
                <h3 class="cash-flow-title">Cash Flow Analysis</h3>
                <p style="color: #86868b; font-size: 0.9em; margin-bottom: 20px;">
                    Actual collected revenue vs expected revenue
                </p>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">Monthly Cash Flow</div>
                        <div class="chart-wrapper">
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Collection Rate Trend</div>
                        <div class="chart-wrapper">
                            <canvas id="collectionRateChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="table-container" style="margin-top: 30px;">
                    <table id="cashFlowTable">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Expected Revenue</th>
                                <th>Collected</th>
                                <th>Outstanding</th>
                                <th>Collection %</th>
                                <th>Actual Op Income</th>
                                <th>Actual Margin %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="7" class="loading">Loading cash flow data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://jcgqpihzxlwzncjmkxhi.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjZ3FwaWh6eGx3em5jam1reGhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI2Nzc3MDcsImV4cCI6MjA0ODI1MzcwN30.HKJXz3aM_A9B-3c9z-Cs2Aly_p-NN8sdQoV5lgMrFVQ';
        
        let supabase;
        let currentSort = { column: null, direction: 'asc' };
        let monthlyData = [];
        let cashFlowData = [];
        let currentFilter = 'all';
        let revenueChart, goalChart, marginChart, costChart, cashFlowChart, collectionRateChart;
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            initializeSupabase();
            setCurrentMonth();
            loadAllData();
        });
        
        function initializeSupabase() {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            updateSyncStatus('syncing', 'Connecting...');
            
            setTimeout(() => {
                updateSyncStatus('connected', 'Connected');
                setTimeout(() => {
                    document.getElementById('syncStatus').style.display = 'none';
                }, 2000);
            }, 1000);
        }
        
        function updateSyncStatus(status, message) {
            const syncStatus = document.getElementById('syncStatus');
            if (!syncStatus) return;
            
            syncStatus.className = 'sync-status ' + status;
            syncStatus.innerHTML = `<span class="status-dot">●</span><span>${message}</span>`;
        }
        
        function setCurrentMonth() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const monthSelector = document.getElementById('monthSelector');
            if (monthSelector) {
                monthSelector.value = `${year}-${month}`;
            }
        }
        
        async function loadAllData() {
            await Promise.all([
                loadClients(),
                loadPayments(),
                loadCosts(),
                loadAnalytics()
            ]);
            updateMetrics();
            updatePaymentHistory();
        }
        
        // Payment Functions
        async function loadPayments() {
            const month = document.getElementById('monthSelector').value;
            const [year, monthNum] = month.split('-');
            
            try {
                const { data: payments, error } = await supabase
                    .from('payments')
                    .select('*, clients(name, amount)')
                    .eq('month', parseInt(monthNum))
                    .eq('year', parseInt(year));
                
                if (error) throw error;
                
                displayPayments(payments || []);
            } catch (error) {
                console.error('Error loading payments:', error);
                showError('Failed to load payments');
            }
        }
        
        function displayPayments(payments) {
            const tbody = document.querySelector('#paymentsTable tbody');
            if (!tbody) return;
            
            if (payments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="loading">No payments found for this month</td></tr>';
                return;
            }
            
            tbody.innerHTML = payments.map(payment => {
                const clientName = payment.clients?.name || 'Unknown Client';
                const amount = payment.clients?.amount || payment.amount || 0;
                const statusClass = payment.status === 'paid' ? 'status-paid' : 
                                   payment.status === 'paused' ? 'status-paused' : 'status-unpaid';
                const statusDisplay = payment.status === 'paused' ? 
                    `<span class="${statusClass}">paused</span>` :
                    `<span class="${statusClass}" onclick="togglePaymentStatus(${payment.id})">${payment.status}</span>`;
                
                return `
                    <tr>
                        <td>${clientName}</td>
                        <td>$${amount.toLocaleString()}</td>
                        <td>${statusDisplay}</td>
                        <td>${payment.payment_date || '-'}</td>
                        <td>${payment.notes || '-'}</td>
                        <td>
                            <button class="btn-secondary" onclick="editPayment(${payment.id})">Edit</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        async function togglePaymentStatus(paymentId) {
            try {
                const { data: payment } = await supabase
                    .from('payments')
                    .select('status')
                    .eq('id', paymentId)
                    .single();
                
                const newStatus = payment.status === 'paid' ? 'unpaid' : 'paid';
                const paymentDate = newStatus === 'paid' ? new Date().toISOString().split('T')[0] : null;
                
                await supabase
                    .from('payments')
                    .update({ 
                        status: newStatus,
                        payment_date: paymentDate
                    })
                    .eq('id', paymentId);
                
                loadPayments();
                updateMetrics();
                updatePaymentHistory();
            } catch (error) {
                console.error('Error toggling payment status:', error);
            }
        }
        
        async function markAllPaid() {
            if (!confirm('Mark all payments for this month as paid?')) return;
            
            const month = document.getElementById('monthSelector').value;
            const [year, monthNum] = month.split('-');
            const paymentDate = new Date().toISOString().split('T')[0];
            
            try {
                await supabase
                    .from('payments')
                    .update({ 
                        status: 'paid',
                        payment_date: paymentDate
                    })
                    .eq('month', parseInt(monthNum))
                    .eq('year', parseInt(year))
                    .neq('status', 'paused');
                
                loadPayments();
                updateMetrics();
                updatePaymentHistory();
            } catch (error) {
                console.error('Error marking all paid:', error);
            }
        }
        
        function showUnpaid() {
            filterByStatus('unpaid');
        }
        
        function refreshPayments() {
            loadPayments();
            updatePaymentHistory();
        }
        
        function filterByStatus(status, button) {
            currentFilter = status;
            
            // Update button states
            if (button) {
                document.querySelectorAll('.filter-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
            }
            
            const rows = document.querySelectorAll('#paymentsTable tbody tr');
            rows.forEach(row => {
                if (row.querySelector('.loading')) return;
                
                const statusCell = row.querySelector('td:nth-child(3) span');
                if (!statusCell) return;
                
                const rowStatus = statusCell.textContent.toLowerCase();
                
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    row.style.display = rowStatus === status ? '' : 'none';
                }
            });
        }
        
        // Client Functions
        async function loadClients() {
            try {
                const { data: clients, error } = await supabase
                    .from('clients')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                
                displayClients(clients || []);
            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }
        
        function displayClients(clients) {
            const tbody = document.querySelector('#clientsTable tbody');
            if (!tbody) return;
            
            if (clients.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="loading">No clients found</td></tr>';
                return;
            }
            
            tbody.innerHTML = clients.map(client => {
                const statusClass = client.status === 'active' ? 'status-active' : 
                                   client.status === 'paused' ? 'status-paused' : 'status-hidden';
                
                return `
                    <tr>
                        <td>${client.name}</td>
                        <td>$${client.amount.toLocaleString()}</td>
                        <td>${client.start_date || '-'}</td>
                        <td><span class="${statusClass}">${client.status}</span></td>
                        <td>${client.notes || '-'}</td>
                        <td>
                            <button class="btn-secondary" onclick="editClient(${client.id})">Edit</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function showAddClientForm() {
            document.getElementById('addClientForm').style.display = 'block';
        }
        
        function hideAddClientForm() {
            document.getElementById('addClientForm').style.display = 'none';
            // Clear form
            document.getElementById('newClientName').value = '';
            document.getElementById('newClientAmount').value = '';
            document.getElementById('newClientStartDate').value = '';
            document.getElementById('newClientStatus').value = 'active';
            document.getElementById('newClientNotes').value = '';
        }
        
        async function addClient() {
            const name = document.getElementById('newClientName').value;
            const amount = parseFloat(document.getElementById('newClientAmount').value);
            const startDate = document.getElementById('newClientStartDate').value;
            const status = document.getElementById('newClientStatus').value;
            const notes = document.getElementById('newClientNotes').value;
            
            if (!name || !amount) {
                alert('Please enter client name and amount');
                return;
            }
            
            try {
                await supabase
                    .from('clients')
                    .insert([{
                        name,
                        amount,
                        start_date: startDate || null,
                        status,
                        notes
                    }]);
                
                hideAddClientForm();
                loadClients();
                updateMetrics();
            } catch (error) {
                console.error('Error adding client:', error);
                alert('Failed to add client');
            }
        }
        
        function refreshClients() {
            loadClients();
        }
        
        function exportClients() {
            // Export functionality
            alert('Export feature coming soon');
        }
        
        // Cost Functions
        async function loadCosts() {
            try {
                const { data: costs, error } = await supabase
                    .from('costs')
                    .select('*')
                    .order('date', { ascending: false });
                
                if (error) throw error;
                
                displayCosts(costs || []);
            } catch (error) {
                console.error('Error loading costs:', error);
            }
        }
        
        function displayCosts(costs) {
            const tbody = document.querySelector('#costsTable tbody');
            if (!tbody) return;
            
            if (costs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="loading">No costs found</td></tr>';
                return;
            }
            
            tbody.innerHTML = costs.map(cost => `
                <tr>
                    <td>${cost.description}</td>
                    <td>$${cost.amount.toLocaleString()}</td>
                    <td>${cost.type}</td>
                    <td>${cost.date || '-'}</td>
                    <td>${cost.notes || '-'}</td>
                    <td>
                        <button class="btn-secondary" onclick="editCost(${cost.id})">Edit</button>
                    </td>
                </tr>
            `).join('');
        }
        
        function showAddCostForm() {
            document.getElementById('addCostForm').style.display = 'block';
            document.getElementById('newCostDate').value = new Date().toISOString().split('T')[0];
        }
        
        function hideAddCostForm() {
            document.getElementById('addCostForm').style.display = 'none';
            // Clear form
            document.getElementById('newCostDescription').value = '';
            document.getElementById('newCostAmount').value = '';
            document.getElementById('newCostType').value = 'fixed';
            document.getElementById('newCostNotes').value = '';
        }
        
        async function addCost() {
            const description = document.getElementById('newCostDescription').value;
            const amount = parseFloat(document.getElementById('newCostAmount').value);
            const type = document.getElementById('newCostType').value;
            const date = document.getElementById('newCostDate').value;
            const notes = document.getElementById('newCostNotes').value;
            
            if (!description || !amount) {
                alert('Please enter description and amount');
                return;
            }
            
            try {
                await supabase
                    .from('costs')
                    .insert([{
                        description,
                        amount,
                        type,
                        date,
                        notes
                    }]);
                
                hideAddCostForm();
                loadCosts();
                updateMetrics();
            } catch (error) {
                console.error('Error adding cost:', error);
                alert('Failed to add cost');
            }
        }
        
        function refreshCosts() {
            loadCosts();
        }
        
        function exportCosts() {
            alert('Export feature coming soon');
        }
        
        // Analytics Functions
        async function loadAnalytics() {
            try {
                // Get all clients
                const { data: clients } = await supabase
                    .from('clients')
                    .select('*');
                
                // Get all payments
                const { data: payments } = await supabase
                    .from('payments')
                    .select('*');
                
                // Get all costs
                const { data: costs } = await supabase
                    .from('costs')
                    .select('*');
                
                // Process data by month
                processMonthlyData(clients, payments, costs);
                updateCharts();
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }
        
        function processMonthlyData(clients, payments, costs) {
            monthlyData = [];
            cashFlowData = [];
            
            // Get date range
            const currentDate = new Date();
            const startDate = new Date(2024, 0, 1); // January 2024
            
            for (let d = new Date(startDate); d <= currentDate; d.setMonth(d.getMonth() + 1)) {
                const year = d.getFullYear();
                const month = d.getMonth() + 1;
                const monthStr = `${year}-${String(month).padStart(2, '0')}`;
                
                // Calculate expected revenue (all active clients for that month)
                let expectedRevenue = 0;
                clients.forEach(client => {
                    if (client.status === 'active' || client.status === 'paused') {
                        const clientStart = new Date(client.start_date || '2024-01-01');
                        if (clientStart <= d) {
                            expectedRevenue += client.amount;
                        }
                    }
                });
                
                // Calculate actual collected revenue
                const monthPayments = payments.filter(p => p.year === year && p.month === month);
                const collectedRevenue = monthPayments
                    .filter(p => p.status === 'paid')
                    .reduce((sum, p) => sum + (p.amount || 0), 0);
                
                // Calculate costs
                const monthCosts = costs.filter(c => {
                    const costDate = new Date(c.date);
                    return costDate.getFullYear() === year && costDate.getMonth() + 1 === month;
                });
                const totalCosts = monthCosts.reduce((sum, c) => sum + c.amount, 0);
                
                // Add to monthly data (for expected revenue charts)
                monthlyData.push({
                    month: monthStr,
                    revenue: expectedRevenue,
                    opIncome: expectedRevenue - totalCosts,
                    costs: totalCosts,
                    margin: expectedRevenue > 0 ? ((expectedRevenue - totalCosts) / expectedRevenue * 100) : 0,
                    goal: 50000 // Default goal
                });
                
                // Add to cash flow data (for actual collected revenue)
                cashFlowData.push({
                    month: monthStr,
                    expected: expectedRevenue,
                    collected: collectedRevenue,
                    outstanding: expectedRevenue - collectedRevenue,
                    collectionRate: expectedRevenue > 0 ? (collectedRevenue / expectedRevenue * 100) : 0,
                    actualOpIncome: collectedRevenue - totalCosts,
                    actualMargin: collectedRevenue > 0 ? ((collectedRevenue - totalCosts) / collectedRevenue * 100) : 0,
                    costs: totalCosts
                });
            }
        }
        
        function updateCharts() {
            if (!monthlyData || monthlyData.length === 0) return;
            
            const timeRange = document.getElementById('chartTimeRange').value;
            let filteredData = filterDataByTimeRange(monthlyData, timeRange);
            let filteredCashFlow = filterDataByTimeRange(cashFlowData, timeRange);
            
            // Update expected revenue charts
            updateRevenueChart(filteredData);
            updateGoalChart(filteredData);
            updateMarginChart(filteredData);
            updateCostChart(filteredData);
            
            // Update cash flow charts
            updateCashFlowChart(filteredCashFlow);
            updateCollectionRateChart(filteredCashFlow);
            updateCashFlowTable(filteredCashFlow);
        }
        
        function filterDataByTimeRange(data, range) {
            if (!data || data.length === 0) return [];
            
            const now = new Date();
            let filtered = [...data];
            
            switch(range) {
                case '2025':
                    filtered = data.filter(d => d.month.startsWith('2025'));
                    break;
                case '2024':
                    filtered = data.filter(d => d.month.startsWith('2024'));
                    break;
                case 'last12':
                    filtered = data.slice(-12);
                    break;
                case 'last6':
                    filtered = data.slice(-6);
                    break;
            }
            
            return filtered;
        }
        
        function updateRevenueChart(data) {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;
            
            if (revenueChart) revenueChart.destroy();
            
            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Expected Revenue',
                        data: data.map(d => d.revenue),
                        borderColor: '#000000',
                        backgroundColor: 'rgba(0, 0, 0, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Expected Operating Income',
                        data: data.map(d => d.opIncome),
                        borderColor: '#2e7d32',
                        backgroundColor: 'rgba(46, 125, 50, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => '$' + value.toLocaleString()
                            }
                        }
                    }
                }
            });
        }
        
        function updateGoalChart(data) {
            const ctx = document.getElementById('goalChart');
            if (!ctx) return;
            
            if (goalChart) goalChart.destroy();
            
            goalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Expected Revenue',
                        data: data.map(d => d.revenue),
                        backgroundColor: '#000000'
                    }, {
                        label: 'Goal',
                        data: data.map(d => d.goal),
                        backgroundColor: '#e5e5e7'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => '$' + value.toLocaleString()
                            }
                        }
                    }
                }
            });
        }
        
        function updateMarginChart(data) {
            const ctx = document.getElementById('marginChart');
            if (!ctx) return;
            
            if (marginChart) marginChart.destroy();
            
            marginChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Expected Margin %',
                        data: data.map(d => d.margin),
                        borderColor: '#1565c0',
                        backgroundColor: 'rgba(21, 101, 192, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }
        
        function updateCostChart(data) {
            const ctx = document.getElementById('costChart');
            if (!ctx) return;
            
            if (costChart) costChart.destroy();
            
            costChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Expected Revenue',
                        data: data.map(d => d.revenue),
                        backgroundColor: '#2e7d32'
                    }, {
                        label: 'Costs',
                        data: data.map(d => d.costs),
                        backgroundColor: '#c62828'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => '$' + value.toLocaleString()
                            }
                        }
                    }
                }
            });
        }
        
        function updateCashFlowChart(data) {
            const ctx = document.getElementById('cashFlowChart');
            if (!ctx) return;
            
            if (cashFlowChart) cashFlowChart.destroy();
            
            cashFlowChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Expected',
                        data: data.map(d => d.expected),
                        backgroundColor: '#e5e5e7'
                    }, {
                        label: 'Collected',
                        data: data.map(d => d.collected),
                        backgroundColor: '#2e7d32'
                    }, {
                        label: 'Outstanding',
                        data: data.map(d => d.outstanding),
                        backgroundColor: '#c62828'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => '$' + value.toLocaleString()
                            }
                        }
                    }
                }
            });
        }
        
        function updateCollectionRateChart(data) {
            const ctx = document.getElementById('collectionRateChart');
            if (!ctx) return;
            
            if (collectionRateChart) collectionRateChart.destroy();
            
            collectionRateChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Collection Rate %',
                        data: data.map(d => d.collectionRate),
                        borderColor: '#000000',
                        backgroundColor: 'rgba(0, 0, 0, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Target (90%)',
                        data: data.map(() => 90),
                        borderColor: '#2e7d32',
                        borderDash: [5, 5],
                        backgroundColor: 'transparent'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }
        
        function updateCashFlowTable(data) {
            const tbody = document.querySelector('#cashFlowTable tbody');
            if (!tbody) return;
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="loading">No cash flow data available</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(d => {
                const collectionClass = d.collectionRate >= 90 ? 'status-paid' : 
                                       d.collectionRate >= 75 ? 'status-paused' : 'status-unpaid';
                
                return `
                    <tr>
                        <td>${d.month}</td>
                        <td>$${d.expected.toLocaleString()}</td>
                        <td>$${d.collected.toLocaleString()}</td>
                        <td>$${d.outstanding.toLocaleString()}</td>
                        <td><span class="${collectionClass}">${d.collectionRate.toFixed(1)}%</span></td>
                        <td>$${d.actualOpIncome.toLocaleString()}</td>
                        <td>${d.actualMargin.toFixed(1)}%</td>
                    </tr>
                `;
            }).join('');
        }
        
        function exportAnalytics() {
            alert('Export feature coming soon');
        }
        
        // Payment History Grid
        async function updatePaymentHistory() {
            try {
                const { data: clients } = await supabase
                    .from('clients')
                    .select('*')
                    .order('name');
                
                const { data: payments } = await supabase
                    .from('payments')
                    .select('*');
                
                displayPaymentHistory(clients, payments);
            } catch (error) {
                console.error('Error loading payment history:', error);
            }
        }
        
        function displayPaymentHistory(clients, payments) {
            const grid = document.getElementById('paymentHistoryGrid');
            if (!grid) return;
            
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            const filter = document.getElementById('historyFilter').value;
            
            // Filter clients based on selection
            let filteredClients = clients.filter(client => {
                // Hide clients that have been paused for 4+ months
                if (client.status === 'paused') {
                    // For now, just hide paused clients if we have 4+ months of data
                    if (currentMonth >= 4) {
                        return false;
                    }
                }
                
                const clientPayments = payments.filter(p => 
                    p.client_id === client.id && 
                    p.year === currentYear
                );
                
                switch(filter) {
                    case 'unpaid-current':
                        return clientPayments.some(p => p.month === currentMonth && p.status === 'unpaid');
                    case 'has-unpaid':
                        return clientPayments.some(p => p.status === 'unpaid');
                    case 'multiple-unpaid':
                        return clientPayments.filter(p => p.status === 'unpaid').length >= 2;
                    default:
                        return true;
                }
            });
            
            // Build grid HTML
            let html = '<table><thead><tr><th>Client</th>';
            
            // Add month headers
            for (let m = 1; m <= currentMonth; m++) {
                const monthName = new Date(currentYear, m - 1, 1).toLocaleDateString('en-US', { month: 'short' });
                html += `<th class="month-cell">${monthName}</th>`;
            }
            html += '</tr></thead><tbody>';
            
            // Add client rows
            filteredClients.forEach(client => {
                const clientPayments = payments.filter(p => p.client_id === client.id && p.year === currentYear);
                let unpaidCount = 0;
                
                html += `<tr><td class="client-name">${client.name}</td>`;
                
                for (let m = 1; m <= currentMonth; m++) {
                    const payment = clientPayments.find(p => p.month === m);
                    const clientStart = new Date(client.start_date || '2024-01-01');
                    const monthDate = new Date(currentYear, m - 1, 1);
                    
                    let cellClass = 'month-cell ';
                    let cellContent = '';
                    
                    if (clientStart > monthDate) {
                        cellClass += 'inactive';
                        cellContent = '-';
                    } else if (payment) {
                        if (payment.status === 'paid') {
                            cellClass += 'paid';
                            cellContent = '✓';
                            unpaidCount = 0;
                        } else if (payment.status === 'paused') {
                            cellClass += 'paused';
                            cellContent = '⏸';
                            unpaidCount = 0;
                        } else {
                            cellClass += 'unpaid';
                            cellContent = '✗';
                            unpaidCount++;
                        }
                    } else {
                        cellClass += 'unpaid';
                        cellContent = '✗';
                        unpaidCount++;
                    }
                    
                    if (unpaidCount >= 2) {
                        cellClass += ' multiple-unpaid';
                    }
                    
                    html += `<td class="${cellClass}">${cellContent}</td>`;
                }
                
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            grid.innerHTML = html;
        }
        
        function exportPaymentGrid() {
            alert('Export feature coming soon');
        }
        
        async function syncPaymentDatabase() {
            if (!confirm('This will create missing payment records for all active clients. Continue?')) {
                return;
            }
            
            try {
                updateSyncStatus('syncing', 'Syncing database...');
                
                const { data: clients } = await supabase
                    .from('clients')
                    .select('*')
                    .eq('status', 'active');
                
                const currentYear = new Date().getFullYear();
                const currentMonth = new Date().getMonth() + 1;
                let recordsCreated = 0;
                
                for (const client of clients) {
                    const clientStart = new Date(client.start_date || '2024-01-01');
                    const startMonth = clientStart.getMonth() + 1;
                    const startYear = clientStart.getFullYear();
                    
                    for (let year = startYear; year <= currentYear; year++) {
                        const monthStart = (year === startYear) ? startMonth : 1;
                        const monthEnd = (year === currentYear) ? currentMonth : 12;
                        
                        for (let month = monthStart; month <= monthEnd; month++) {
                            // Check if payment record exists
                            const { data: existing } = await supabase
                                .from('payments')
                                .select('id')
                                .eq('client_id', client.id)
                                .eq('year', year)
                                .eq('month', month)
                                .single();
                            
                            if (!existing) {
                                // Create payment record
                                await supabase
                                    .from('payments')
                                    .insert({
                                        client_id: client.id,
                                        amount: client.amount,
                                        status: 'unpaid',
                                        month: month,
                                        year: year
                                    });
                                recordsCreated++;
                            }
                        }
                    }
                }
                
                updateSyncStatus('connected', `Sync complete! Created ${recordsCreated} records`);
                setTimeout(() => {
                    document.getElementById('syncStatus').style.display = 'none';
                }, 3000);
                
                // Reload data
                loadPayments();
                updatePaymentHistory();
                
            } catch (error) {
                console.error('Error syncing database:', error);
                updateSyncStatus('error', 'Sync failed');
                setTimeout(() => {
                    document.getElementById('syncStatus').style.display = 'none';
                }, 3000);
            }
        }
        
        // Metrics Functions
        async function updateMetrics() {
            try {
                const currentMonth = document.getElementById('monthSelector').value;
                const [year, month] = currentMonth.split('-');
                
                // Get monthly revenue
                const { data: monthPayments } = await supabase
                    .from('payments')
                    .select('*, clients(amount)')
                    .eq('year', parseInt(year))
                    .eq('month', parseInt(month))
                    .eq('status', 'paid');
                
                const monthlyRevenue = monthPayments?.reduce((sum, p) => sum + (p.clients?.amount || 0), 0) || 0;
                
                // Get YTD revenue
                const { data: ytdPayments } = await supabase
                    .from('payments')
                    .select('*, clients(amount)')
                    .eq('year', parseInt(year))
                    .eq('status', 'paid');
                
                const ytdRevenue = ytdPayments?.reduce((sum, p) => sum + (p.clients?.amount || 0), 0) || 0;
                
                // Get total clients
                const { data: clients } = await supabase
                    .from('clients')
                    .select('*')
                    .eq('status', 'active');
                
                const totalClients = clients?.length || 0;
                
                // Calculate collection rate
                const { data: allMonthPayments } = await supabase
                    .from('payments')
                    .select('*')
                    .eq('year', parseInt(year))
                    .eq('month', parseInt(month));
                
                const totalExpected = allMonthPayments?.length || 0;
                const totalPaid = allMonthPayments?.filter(p => p.status === 'paid').length || 0;
                const collectionRate = totalExpected > 0 ? (totalPaid / totalExpected * 100) : 0;
                
                // Update display
                document.getElementById('monthlyRevenue').textContent = `$${monthlyRevenue.toLocaleString()}`;
                document.getElementById('ytdRevenue').textContent = `$${ytdRevenue.toLocaleString()}`;
                document.getElementById('totalClients').textContent = totalClients;
                document.getElementById('collectionRate').textContent = `${collectionRate.toFixed(1)}%`;
                
            } catch (error) {
                console.error('Error updating metrics:', error);
            }
        }
        
        // Tab Functions
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab button
            event.target.classList.add('active');
            
            // Load data for the selected tab
            switch(tabName) {
                case 'payments':
                    loadPayments();
                    updatePaymentHistory();
                    break;
                case 'clients':
                    loadClients();
                    break;
                case 'costs':
                    loadCosts();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }
        
        // Utility Functions
        function showError(message) {
            updateSyncStatus('error', message);
            setTimeout(() => {
                document.getElementById('syncStatus').style.display = 'none';
            }, 3000);
        }
        
        function editPayment(id) {
            alert('Edit feature coming soon');
        }
        
        function editClient(id) {
            alert('Edit feature coming soon');
        }
        
        function editCost(id) {
            alert('Edit feature coming soon');
        }
    </script>
</body>
</html>
